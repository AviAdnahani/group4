<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <div id="ph">
        <table id="table">
            <tr>
                <td>
                    <select id="productNameSelected"></select>
                </td>
                <td>
                    <input type="text" id="price" placeholder="Price" />
                </td>
                <td>
                    <button onclick="addProduct()">Add</button>
                </td>
            </tr>
        </table>
    </div>
    <div>
        <label>the total price is : </label><span id="totalPrice">0</span>
    </div>
    <div>
        <div>
            <form id="form" target="_blank" onsubmit="return validateCreditCard(event,cardNumber.value)">
                <table>
                    <tr>
                        <td>
                            <input type="text" placeholder="Card Number" id="cardNumber" required />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" placeholder="Name on card" required />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="date" placeholder="Expiry date" required />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" placeholder="Security code" maxlength="3" required />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="submit" value="Submit">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <div id="submitValidation"></div>
    </div>
    <script>

        var cart_productName = ["apple", "candy", "water", "carrot", "umbrella", "proteinShake", "samsung", "nokia", "LG"];
        totalPrice = 0;
        var select_productName = document.getElementById("productNameSelected");
        for (var i in cart_productName) {
            if (cart_productName.hasOwnProperty(i)) {
                var opt_productName = document.createElement("option");
                opt_productName.innerText = cart_productName[i];
                select_productName.appendChild(opt_productName);
            }
        }

        function addProduct() {
            var table = document.getElementById("table");
            var tr = document.createElement("tr");
            var td_productName = document.createElement("td");
            var select_productName = document.getElementById("productNameSelected");
            td_productName.innerText = select_productName.options[select_productName.selectedIndex].text;
            var td_price = document.createElement("td");
            td_price.innerText = document.getElementById("price").value;
            var td_remove = document.createElement("td");
            var remove_button = document.createElement("button");
            remove_button.innerText = "Remove";
            remove_button.onclick = removeProduct;
            td_remove.appendChild(remove_button);
            tr.appendChild(td_productName);
            tr.appendChild(td_price);
            tr.appendChild(td_remove);
            table.appendChild(tr);

            totalPrice += Number(td_price.innerText);
            document.getElementById("totalPrice").innerText = totalPrice;
        }


        function removeProduct(e) {

            var td = e.target.parentNode;
            var tr = td.parentNode;
            var price = tr.childNodes[1].innerText;
            var table = tr.parentNode;
            table.removeChild(tr);

            totalPrice -= Number(price);
            document.getElementById("totalPrice").innerText = totalPrice;
        }




        function validateCreditCard(event, CreditCardNumber) {
            event.preventDefault();
            var CreditCardNum = updateCreditCardFormat(CreditCardNumber);
            var div = document.getElementById("submitValidation");
            if (!numberLengthValidation(CreditCardNum)) {
                div.innerText = "wrong_length";
                return;
            }
            if (!areNumbers(CreditCardNum)) {
                div.innerText = "only one type of number";
                return;
            }
            if (areTheSameDigits(CreditCardNum)) {
                div.innerText = "invalid characters";
                return;
            }
            if (!isFinalDigitEven(CreditCardNum)) {
                div.innerText = "odd final number";
                return;
            }
            if (!isSumGreaterThanSixTeen(CreditCardNum)) {
                div.innerText = "sum less than 16";
                return;
            }

            div.innerText = CreditCardNumber + " is correct number";
            var form = document.getElementById("form");
            form.action = "http://localhost:3000/Order";
            form.method = "POST";
            form.submit();
            return;


            function updateCreditCardFormat(CreditCardNumber) {
                var CreditCard = CreditCardNumber.split("-");
                if (CreditCard.length > 0) {
                    var updateCreditCard = "";
                    for (var i = 0; i < CreditCard.length; i++) {
                        updateCreditCard += CreditCard[i];
                    }
                    return updateCreditCard;
                }
                else
                    return CreditCardNumber;
            }


            function numberLengthValidation(CreditCardNum) {
                CreditCard_len = CreditCardNum.split("").length;
                return CreditCard_len === 16;
            }


            function areNumbers(CreditCardNum) {
                CreditCardNum_numbers = CreditCardNum.split("");
                var isNumber = true;
                for (var i = 0; i < CreditCardNum_numbers.length; i++) {
                    isNumber = isNumber && !isNaN(CreditCardNum_numbers[i]);
                }
                return isNumber;
            }


            function areTheSameDigits(CreditCardNum) {
                var CreditCardDigits = CreditCardNum.split("");
                var areTheSame = true;
                for (var i = 0; i < CreditCardDigits.length - 1; i++) {
                    if (CreditCardDigits[i] != CreditCardDigits[i + 1]) {
                        areTheSame = false;
                        break;
                    }
                }
                return areTheSame;
            }


            function isFinalDigitEven(CreditCardNum) {
                var CreditCardDigits = CreditCardNum.split("");
                var lastDigit = CreditCardDigits[CreditCardDigits.length - 1];
                return lastDigit % 2 === 0;
            }


            function isSumGreaterThanSixTeen(CreditCardNum) {
                var CreditCardDigits = CreditCardNum.split("");
                var sum = 0;
                for (var i = 0; i < CreditCardDigits.length; i++) {
                    sum += Number(CreditCardDigits[i]);
                }
                return sum > 16;
            }

        }





    </script>


</body>

</html>